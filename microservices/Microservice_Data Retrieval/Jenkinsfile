pipeline {
    agent any
    stages {
        stage('Prepare environment') {
            steps {                 
                sh '''
                    echo 'Start installing dependencies'
                    #!/bin/bash
                    rm -Rf ~/Builds/$PROJECT
                    CODE_HOME=~/Builds/$PROJECT/code
                    PYENV_HOME=~/Builds/$PROJECT/python
                    export PYENV_HOME
                    export PYTHONPATH=""
                    echo "Creating new Python env"
                    /usr/local/bin/python3 -m venv  --clear $PYENV_HOME
                    source $PYENV_HOME/bin/activate
                    pip install -r "microservices/Microservice_Data Retrieval/requirements.txt"
                    echo 'Start running test cases'
                    python "microservices/Microservice_Data Retrieval/app/tests/test.py"
                '''    
             }
        }
        stage('Deploy') {
            steps {
            sh '''
                #cd dir/200-ok/flask-api/
                #git pull
                #git checkout develop
                cd "microservices/Microservice_Data Retrieval"
                docker build -t dataretrieval-service .
                #docker login
                #docker tag flask-service 200okdocker/flask-service
                #docker push 200okdocker/flask-service
            '''    
            }
        }
    }
}
